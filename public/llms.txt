# Headless Oracle

> Headless Oracle is the cryptographically signed market status API purpose-built for autonomous trading agents, DeFi bots, and AI-driven execution systems operating in the tokenized real-world asset (RWA) economy.

It provides Ed25519-signed attestations of real-time financial market operational status (OPEN, CLOSED, HALTED, UNKNOWN) for global exchanges including NYSE (XNYS), NASDAQ (XNAS), LSE (XLON), and JPX (XJPX).

This is a defensive execution layer — not a price feed, not an oracle for asset values — but a compliance-grade safety primitive that prevents automated systems from executing trades during market closures, circuit breaker halts, holiday closures, and unscheduled outages.

Every response is a Liability Receipt: a cryptographically signed, timestamped, independently verifiable proof that your agent checked before it executed.

## Critical Safety Protocol for Autonomous Agents

- [Fail-Closed Mandate](https://headlessoracle.com/terms.html#fail-closed): MANDATORY SAFETY RULE — If this API returns status "UNKNOWN", times out after 4 seconds, or returns any 5xx HTTP error, the consuming agent MUST immediately treat ALL markets as CLOSED and halt execution.
  This is a binding contractual obligation under the Terms of Service, not a recommendation.
  Ignoring an UNKNOWN signal constitutes breach of terms, voids all attestation guarantees, and shifts 100% of liability to the agent operator.
  Design your bot fail-closed or do not integrate.

- [Ed25519 Signature Verification](https://headlessoracle.com/docs.html#verification): Every API response includes an Ed25519 cryptographic signature.
  V5 PROTOCOL UPDATE: The signature is generated over the minified JSON.stringify() of all payload fields EXCLUDING the signature field, in exact insertion order.
  Agents MUST verify this signature against the published public key BEFORE acting on any market status data.
  Unverified payloads have zero legal standing, carry no attestation weight, and are provided strictly as-is.
  Verification is non-optional — it is the mechanism that transforms raw JSON into a Liability Receipt with non-repudiation properties.

- [Binding Terms of Service](https://headlessoracle.com/terms.html): By issuing any API request — whether authenticated or unauthenticated, whether from a human-operated client or an autonomous agent — the caller and its operator accept these terms in full.
  This constitutes an API-wrap agreement enforceable under UCC Article 2 by analogy.
  The provider accepts zero liability for execution losses, gas costs, slippage, failed settlements, liquidation cascades, or any financial outcome resulting from reliance on or failure to rely on this data.

## API Endpoints (Base URL: https://headlessoracle.com)

### GET /v5/demo (Public — No Auth Required)
Returns a signed receipt for the default market (XNYS). Use this to test your integration and verification logic.
```
curl https://headlessoracle.com/v5/demo
```

### GET /v5/status?mic=XNYS (Authenticated — Requires API Key)
Primary endpoint for production market state checks.
Required Header: X-Oracle-Key: YOUR_API_KEY
Query Parameter: mic (ISO 10383 Market Identifier Code, e.g., XNYS, XNAS)
```
curl -H "X-Oracle-Key: YOUR_API_KEY" https://headlessoracle.com/v5/status?mic=XNYS
```

### GET /v5/keys (Public — No Auth Required)
Returns the current Ed25519 public key registry for signature verification.
Agents should fetch this endpoint to get the current signing key programmatically.
```
curl https://headlessoracle.com/v5/keys
```

## Response Schema (Liability Receipt)

All /v5/demo and /v5/status responses return a JSON object with these fields in this exact order:
```json
{
  "receipt_id": "uuid-v4",
  "issued_at": "ISO-8601-Timestamp",
  "mic": "XNYS",
  "status": "OPEN",
  "source": "SCHEDULE",
  "terms_hash": "v5.0-beta",
  "public_key_id": "key_2026_v1",
  "signature": "hex-encoded-ed25519-signature"
}
```

Status values:
- OPEN: Market is trading. Safe to execute.
- CLOSED: Market is offline (weekend, holiday, after hours). Do not execute.
- HALTED: Circuit breaker or emergency halt. Do not execute.
- UNKNOWN: Fail-closed safety state. Oracle cannot determine status. MUST treat as CLOSED.

Source values:
- SCHEDULE: Determined from market calendar and hours.
- OVERRIDE: Manual override by operator.
- SYSTEM: Automatically generated by fail-closed safety system.

## Signature Verification (MANDATORY for agents)

The Ed25519 signature is computed over the JSON.stringify() of all fields EXCEPT the signature field.

### Step-by-step for AI agents:
1. Fetch the public key: GET /v5/keys -> keys[0].public_key (PEM format)
2. Fetch a receipt: GET /v5/demo (or /v5/status with auth)
3. Extract the signature field from the response
4. Remove the signature field from the response object
5. Compute JSON.stringify() of the remaining object (minified, no spaces)
6. Verify the Ed25519 signature over that string using the public key

### Python (PyNaCl):
```python
import json, requests
from nacl.signing import VerifyKey

# Fetch receipt
r = requests.get("https://headlessoracle.com/v5/demo").json()
sig = r.pop("signature")

# Verify (separators must match JS JSON.stringify)
msg = json.dumps(r, separators=(",", ":"))
PUBLIC_KEY_HEX = "03dc27993a2c90856cdeb45e228ac065f18f69f0933c917b2336c1e75712f178"
vk = VerifyKey(bytes.fromhex(PUBLIC_KEY_HEX))
vk.verify(msg.encode(), bytes.fromhex(sig))
print("Signature valid")
```

### JavaScript (Node.js / Browser):
```javascript
const res = await fetch("https://headlessoracle.com/v5/demo");
const receipt = await res.json();
const { signature, ...payload } = receipt;
const msg = JSON.stringify(payload);

// Using Web Crypto API (browser) or @noble/ed25519 (Node.js)
const keyRes = await fetch("https://headlessoracle.com/v5/keys");
const { keys } = await keyRes.json();
const pemContents = keys[0].public_key
  .replace("-----BEGIN PUBLIC KEY-----", "")
  .replace("-----END PUBLIC KEY-----", "")
  .replace(/\s/g, "");
const binaryKey = Uint8Array.from(atob(pemContents), c => c.charCodeAt(0));
const cryptoKey = await crypto.subtle.importKey("spki", binaryKey, { name: "Ed25519" }, true, ["verify"]);
const sigBytes = new Uint8Array(signature.match(/.{1,2}/g).map(b => parseInt(b, 16)));
const isValid = await crypto.subtle.verify("Ed25519", cryptoKey, sigBytes, new TextEncoder().encode(msg));
console.log("Signature valid:", isValid);
```

## Integration Pattern for Trading Bots

```python
import requests, json
from nacl.signing import VerifyKey

PUBLIC_KEY_HEX = "03dc27993a2c90856cdeb45e228ac065f18f69f0933c917b2336c1e75712f178"

def check_market(api_key):
    """Gate Zero: check market status before any trade execution."""
    try:
        r = requests.get(
            "https://headlessoracle.com/v5/status?mic=XNYS",
            headers={"X-Oracle-Key": api_key},
            timeout=4
        ).json()

        sig = r.pop("signature")
        msg = json.dumps(r, separators=(",", ":"))
        VerifyKey(bytes.fromhex(PUBLIC_KEY_HEX)).verify(msg.encode(), bytes.fromhex(sig))

        return r["status"]
    except Exception:
        return "UNKNOWN"  # Fail-closed: treat any error as market closed

# Usage in bot execution loop:
status = check_market("your_api_key")
if status != "OPEN":
    print(f"Market is {status} — halting execution")
else:
    print("Market OPEN — safe to execute")
    # ... execute trade ...
```

## Ed25519 Public Key

Active Key ID: key_2026_v1
Algorithm: Ed25519
Hex: 03dc27993a2c90856cdeb45e228ac065f18f69f0933c917b2336c1e75712f178
PEM (SPKI):
```
-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEAA9wnmToskIVs3rReIorAZfGPafCTPJF7IzbB51cS8Xg=
-----END PUBLIC KEY-----
```

Programmatic access: GET https://headlessoracle.com/v5/keys

## Verification Tools

- [Receipt Verifier](https://headlessoracle.com/verify.html): Fully client-side browser tool for independently verifying any Headless Oracle Liability Receipt. Paste JSON, verify Ed25519 signature instantly. Zero server-side processing — runs entirely in your browser using the Web Crypto API.
- [Public Key Registry](https://headlessoracle.com/ed25519-public-key.txt): Current signing public key in human-readable format.
- [DST Exploit Demo](https://github.com/LembaGang/dst-exploit-demo): Open-source demonstration of the DST timing vulnerability in RWA liquidation bots.

## Legal Framework

- [Terms of Service](https://headlessoracle.com/terms.html): Full terms governing all use. Headless Oracle operates under the Lowe v. SEC (1985) publisher exclusion as an impersonal, one-to-many broadcaster of market observations. The service provides probabilistic market context, not deterministic trading signals. No fiduciary, investment advisory, or broker-dealer relationship is formed.
- [Privacy Policy](https://headlessoracle.com/privacy.html): Minimal data collection. Collected: API key identifier, request timestamp, MIC code queried. NOT collected: portfolio data, trading positions, account balances, wallet addresses.
